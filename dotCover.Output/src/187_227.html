<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Users/vieir4ndo/Workspace/construtora-viver-sa/src/ConstrutoraViverSA.Application/Services/OrcamentoService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using ConstrutoraViverSA.Domain;
using System.Collections.Generic;
using AutoMapper;
using ConstrutoraViverSA.Application.Interfaces;
using ConstrutoraViverSA.Domain.Dtos;
using ConstrutoraViverSA.Domain.Exceptions;
using ConstrutoraViverSA.Repository.Interfaces;

namespace ConstrutoraViverSA.Application.Services;

public class OrcamentoService : IOrcamentoService
{
    private readonly IOrcamentoRepository _repository;
    private readonly IMapper _mapper;

    public OrcamentoService(IOrcamentoRepository repository, IMapper mapper)
    {
        _repository = repository;
        _mapper = mapper;
    }

    public List&lt;OrcamentoDto&gt; BuscarTodos()
    {
        var orcamentos = _repository.BuscarTodos();

        var listaOrcamentosDto = new List&lt;OrcamentoDto&gt;();
            
        orcamentos.ForEach(x =&gt; listaOrcamentosDto.Add(_mapper.Map&lt;OrcamentoDto&gt;(x)));

        return listaOrcamentosDto;
    }

    public OrcamentoDto BuscarPorId(long buscaId)
    {
        var orcamento = BuscarEntidadePorId(buscaId);

        return _mapper.Map&lt;OrcamentoDto&gt;(orcamento);
    }


    public Orcamento BuscarEntidadePorId(long buscaId)
    {
        var orcamento = _repository.BuscarPorId(buscaId);

        if (orcamento is null)
        {
            throw new NaoEncontradoException(&quot;Or&#231;amento n&#227;o encontrado&quot;);
        }

        return orcamento;
    }

    public void Adicionar(OrcamentoDto dto)
    {
        var orcamento = new Orcamento(dto.Descricao, dto.Endereco, dto.TipoObra, dto.DataEmissao, dto.DataValidade,
            dto.Valor);
        _repository.Adicionar(orcamento);
    }

    public void Excluir(long idExcluir)
    {
        var orcamento = BuscarEntidadePorId(idExcluir);

        _repository.Excluir(orcamento);
    }

    public void Editar(long id, OrcamentoDto orcamentolAtualizado)
    {
        var orcamento = BuscarEntidadePorId(id);

        orcamento.SetDescricao(orcamentolAtualizado.Descricao);
        orcamento.SetEndereco(orcamentolAtualizado.Endereco);
        orcamento.SetTipoObra(orcamentolAtualizado.TipoObra);
        orcamento.SetDataEmissao(orcamentolAtualizado.DataEmissao);
        orcamento.SetDataValidade(orcamentolAtualizado.DataValidade);
        orcamento.SetValor(orcamentolAtualizado.Valor);

        _repository.Editar(orcamento);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,5,16,77,1],[17,5,17,6,1],[18,9,18,34,1],[19,9,19,26,1],[20,5,20,6,1],[23,5,23,6,1],[24,9,24,52,1],[26,9,26,59,1],[28,9,28,33,1],[28,33,28,85,1],[28,85,28,87,1],[30,9,30,35,1],[31,5,31,6,1],[34,5,34,6,1],[35,9,35,54,1],[37,9,37,53,1],[38,5,38,6,1],[42,5,42,6,1],[43,9,43,58,1],[45,9,45,31,1],[46,9,46,10,1],[47,13,47,74,1],[50,9,50,26,1],[51,5,51,6,1],[54,5,54,6,1],[55,9,56,24,1],[57,9,57,42,1],[58,5,58,6,1],[61,5,61,6,1],[62,9,62,56,1],[64,9,64,40,1],[65,5,65,6,1],[68,5,68,6,1],[69,9,69,49,1],[71,9,71,64,1],[72,9,72,62,1],[73,9,73,62,1],[74,9,74,68,1],[75,9,75,70,1],[76,9,76,56,1],[78,9,78,39,1],[79,5,79,6,1]]);
    </script>
  </body>
</html>