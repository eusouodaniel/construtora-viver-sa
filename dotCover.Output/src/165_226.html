<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Users/vieir4ndo/Workspace/construtora-viver-sa/src/ConstrutoraViverSA.Domain/Orcamento.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
#nullable enable
using System;
using System.Diagnostics.CodeAnalysis;
using System.Text;
using ConstrutoraViverSA.Domain.Enums;
using ConstrutoraViverSA.Domain.Exceptions;

namespace ConstrutoraViverSA.Domain;

public sealed class Orcamento
{
    public long Id;
    public string Descricao { get; private set; }
    public string Endereco { get; private set; }
    public TipoObraEnum TipoObra { get; private set; }
    public DateTime DataEmissao { get; private set; }
    public DateTime DataValidade { get; private set; }
    public double? Valor { get; private set; }
    public Obra? Obra;
    
    [ExcludeFromCodeCoverage]
    public Orcamento()
    {
    }

    public Orcamento(string descricao, string endereco, TipoObraEnum? tipoObra, DateTime? dataEmissao,
        DateTime? dataValidade, double? valor)
    {
        var erros = new StringBuilder();
        
        if (string.IsNullOrWhiteSpace(descricao))
            erros.Append(&quot;Descri&#231;&#227;o inv&#225;lida.&quot;);

        if (string.IsNullOrWhiteSpace(endereco))
            erros.Append(&quot;Endere&#231;o inv&#225;lido.&quot;);

        if (tipoObra is null)
            erros.Append(&quot;Tipo Obra inv&#225;lido.&quot;);

        if (dataEmissao is null || dataEmissao == DateTime.MinValue)
            erros.Append(&quot;Data Emiss&#227;o inv&#225;lida.&quot;);
        
        if (dataValidade is null || dataValidade == DateTime.MinValue)
            erros.Append(&quot;Data Validade inv&#225;lida.&quot;);

        if (dataEmissao.HasValue &amp;&amp; dataValidade.HasValue)
        {
            if (dataValidade!.Value &lt; dataEmissao!.Value)
                erros.Append(&quot;Data de Emiss&#227;o e Data de Validade em intervalo inv&#225;lido.&quot;);
        }

        if (valor is null or &lt;= 0)
            erros.Append(&quot;Valor inv&#225;lido.&quot;);

        if (erros.Length &gt; 0)
            throw new OrcamentoInvalidoException(erros.ToString());
        
        Descricao = descricao;
        Endereco = endereco;
        TipoObra = tipoObra!.Value;
        DataEmissao = dataEmissao!.Value;
        DataValidade = dataValidade!.Value;
        Valor = valor!.Value;
    }

    public void SetDescricao(string descricao)
    {
        if (string.IsNullOrWhiteSpace(descricao))
            return;

        Descricao = descricao;
    }

    public void SetEndereco(string endereco)
    {
        if (string.IsNullOrWhiteSpace(endereco))
            return;

        Endereco = endereco;
    }

    public void SetTipoObra(TipoObraEnum? tipoObra)
    {
        if (tipoObra is null)
            return;

        TipoObra = tipoObra!.Value;
    }

    public void SetDataEmissao(DateTime? dataEmissao)
    {
        if (dataEmissao is null || dataEmissao &gt; DataValidade)
            return;

        DataEmissao = dataEmissao!.Value;
    }

    public void SetDataValidade(DateTime? dataValidade)
    {
        if (dataValidade is null || dataValidade &lt; DataEmissao)
            return;

        DataValidade = dataValidade!.Value;
    }

    public void SetValor(double? valor)
    {
        if (valor is null or &lt;= 0)
            return;

        Valor = valor;
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,31,13,35,1],[13,36,13,48,1],[14,30,14,34,1],[14,35,14,47,1],[15,36,15,40,1],[15,41,15,53,1],[16,35,16,39,1],[16,40,16,52,1],[17,36,17,40,1],[17,41,17,53,1],[18,28,18,32,1],[18,33,18,45,1],[22,5,22,23,1],[23,5,23,6,1],[24,5,24,6,1],[26,5,27,47,1],[28,5,28,6,1],[29,9,29,41,1],[31,9,31,50,1],[32,13,32,49,1],[34,9,34,49,1],[35,13,35,48,1],[37,9,37,30,1],[38,13,38,49,1],[40,9,40,69,1],[41,13,41,52,1],[43,9,43,71,1],[44,13,44,53,1],[46,9,46,59,1],[47,9,47,10,1],[48,13,48,58,1],[49,17,49,91,1],[50,9,50,10,1],[52,9,52,35,1],[53,13,53,45,1],[55,9,55,30,1],[56,13,56,68,1],[58,9,58,31,1],[59,9,59,29,1],[60,9,60,36,1],[61,9,61,42,1],[62,9,62,44,1],[63,9,63,30,1],[64,5,64,6,1],[67,5,67,6,1],[68,9,68,50,1],[69,13,69,20,1],[71,9,71,31,1],[72,5,72,6,1],[75,5,75,6,1],[76,9,76,49,1],[77,13,77,20,1],[79,9,79,29,1],[80,5,80,6,1],[83,5,83,6,1],[84,9,84,30,1],[85,13,85,20,1],[87,9,87,36,1],[88,5,88,6,1],[91,5,91,6,1],[92,9,92,63,1],[93,13,93,20,1],[95,9,95,42,1],[96,5,96,6,1],[99,5,99,6,1],[100,9,100,64,1],[101,13,101,20,1],[103,9,103,44,1],[104,5,104,6,1],[107,5,107,6,1],[108,9,108,35,1],[109,13,109,20,1],[111,9,111,23,1],[112,5,112,6,1]]);
    </script>
  </body>
</html>