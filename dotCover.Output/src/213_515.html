<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Users/vieir4ndo/Workspace/construtora-viver-sa/tests/ConstrutoraViverSA.Application.Tests/Services/ObraServiceTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Linq;
using AutoFixture;
using AutoMapper;
using ConstrutoraViverSA.Application.Interfaces;
using ConstrutoraViverSA.Application.Services;
using ConstrutoraViverSA.Domain;
using ConstrutoraViverSA.Domain.Dtos;
using ConstrutoraViverSA.Domain.Enums;
using ConstrutoraViverSA.Domain.Exceptions;
using ConstrutoraViverSA.Repository.Interfaces;
using FluentAssertions;
using Moq;
using Xunit;

namespace ConstrutoraViverSA.Application.Tests.Services;

public class ObraServiceTests
{
    private readonly Mock&lt;IObraRepository&gt; _repositoryMock;
    private readonly Mock&lt;IMapper&gt; _mapperMock;
    private readonly Fixture _fixture = new Fixture();
    private readonly ObraService _service; 
    private readonly Mock&lt;IFuncionarioService&gt; _funcionarioServiceMock;
    private readonly Mock&lt;IMaterialService&gt; _materialServiceMock;
    private readonly Mock&lt;IOrcamentoService&gt; _orcamentoServiceMock;
    private readonly Mock&lt;IObraParaObraDto&gt; _obraParaObraDtoServiceMock;

    public ObraServiceTests()
    {
        _repositoryMock = new Mock&lt;IObraRepository&gt;();
        _mapperMock = new Mock&lt;IMapper&gt;();
        _funcionarioServiceMock = new Mock&lt;IFuncionarioService&gt;();
        _materialServiceMock = new Mock&lt;IMaterialService&gt;();
        _orcamentoServiceMock = new Mock&lt;IOrcamentoService&gt;();
        _obraParaObraDtoServiceMock = new Mock&lt;IObraParaObraDto&gt;();
        _service = new ObraService(_repositoryMock.Object, _orcamentoServiceMock.Object, _funcionarioServiceMock.Object, _materialServiceMock.Object,_mapperMock.Object, _obraParaObraDtoServiceMock.Object);
    }

    [Fact]
    public void BuscarTodos_ComDadosValidos_DeveRealizarOperacao()
    {
        var obras = _fixture.CreateMany&lt;Obra&gt;().ToList();
        var obrasDto = _fixture.CreateMany&lt;ObraDto&gt;(3).ToList();
        _repositoryMock.Setup(x =&gt; x.BuscarTodos()).Returns(obras);
        _obraParaObraDtoServiceMock.SetupSequence(x =&gt; x.Mapear(It.IsAny&lt;Obra&gt;()))
            .Returns(obrasDto[0])
            .Returns(obrasDto[1])
            .Returns(obrasDto[2]);

        var resultado = _service.BuscarTodos();

        resultado.Count.Should().Be(obras.Count);
        resultado.Should().BeEquivalentTo(obrasDto);
        _repositoryMock.Verify(x =&gt; x.BuscarTodos(), Times.Once);
        _obraParaObraDtoServiceMock.Verify(x =&gt; x.Mapear(It.IsAny&lt;Obra&gt;()), Times.Exactly(3));
    }

    [Fact]
    public void BuscarEntidadePorId_ComDadosValidos_DeveRealizarOperacao()
    {
        var obraId = 1;
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns(obra);

        var resultado = _service.BuscarEntidadePorId(obraId);

        resultado.Should().NotBeNull();
        resultado.Should().BeOfType&lt;Obra&gt;();
        resultado.Should().BeEquivalentTo(obra);
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
    }
    
    [Fact]
    public void BuscarEntidadePorId_ComDadosInvalidos_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns((Obra)null);

        var resultado = () =&gt; _service.BuscarEntidadePorId(obraId);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
    }
    
    [Fact]
    public void BuscarPorId_ComDadosValidos_DeveRealizarOperacao()
    {
        var obraId = 1;
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        var obraDto = _fixture.Create&lt;ObraDto&gt;();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns(obra);
        _obraParaObraDtoServiceMock.Setup(x =&gt; x.Mapear(It.Is&lt;Obra&gt;(x =&gt; x == obra)))
            .Returns(obraDto);

        var resultado = _service.BuscarPorId(obraId);

        resultado.Should().NotBeNull();
        resultado.Should().BeOfType&lt;ObraDto&gt;();
        resultado.Should().BeEquivalentTo(obraDto);
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _obraParaObraDtoServiceMock.Verify(x =&gt; x.Mapear(It.Is&lt;Obra&gt;(x =&gt; x == obra)), Times.Once);
    }
    
    [Fact]
    public void BuscarPorId_ComDadosInvalidos_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns((Obra)null);

        var resultado = () =&gt; _service.BuscarPorId(obraId);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
    }

    [Fact]
    public void Adicionar_ComDadosValidos_DeveRealizarOperacao()
    {
        var orcamentoId = 1;
        var dto = _fixture.Build&lt;ObraDto&gt;()
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .Create();
        var orcamento = _fixture.Build&lt;Orcamento&gt;()
            .With(x =&gt; x.Id, orcamentoId)
            .Create();
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Returns(orcamento);

        var resultado = () =&gt; _service.Adicionar(dto);

        resultado.Should().NotThrow&lt;ObraInvalidaException&gt;();
        _repositoryMock.Verify(x =&gt; x.Adicionar(It.IsAny&lt;Obra&gt;()), Times.Once);
    }
    
    [Fact]
    public void Adicionar_ComDadosInvalidos_NaoDeveRealizarOperacao()
    {
        var orcamentoId = 1;
        var dto = _fixture.Build&lt;ObraDto&gt;()
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .Without(x =&gt; x.Nome)
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .Create();
        var orcamento = _fixture.Build&lt;Orcamento&gt;()
            .With(x =&gt; x.Id, orcamentoId)
            .Create();
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Returns(orcamento);

        var resultado = () =&gt; _service.Adicionar(dto);

        resultado.Should().Throw&lt;ObraInvalidaException&gt;();
    }

    [Fact]
    public void Adicionar_ComDadosInvalidosEOrcamentoInexistente_NaoDeveRealizarOperacao()
    {
        var orcamentoId = 1;
        var dto = _fixture.Build&lt;ObraDto&gt;()
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .Create();
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Returns((Orcamento)null);

        var resultado = () =&gt; _service.Adicionar(dto);

        resultado.Should().Throw&lt;ObraInvalidaException&gt;();
    }
    
    [Fact]
    public void Adicionar_ComDadosInvalidosEFuncionarioInexistente_NaoDeveRealizarOperacao()
    {
        var orcamentoId = 1;
        var funcionarios = new List&lt;long&gt;() { 1 };
        var dto = _fixture.Build&lt;ObraDto&gt;()
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .With(x =&gt; x.Funcionarios, funcionarios)
            .Without(x =&gt; x.Materiais)
            .Create();
        var orcamento = _fixture.Build&lt;Orcamento&gt;()
            .With(x =&gt; x.Id, orcamentoId)
            .Create();
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Returns(orcamento);

        var resultado = () =&gt; _service.Adicionar(dto);

        resultado.Should().NotThrow&lt;ObraInvalidaException&gt;();
    }
    
    [Fact]
    public void Adicionar_ComDadosInvalidosEMaterialInexistente_NaoDeveRealizarOperacao()
    {
        var orcamentoId = 1;
        var materialId = 1;
        var quantidadeMaterial = 1;
        var materiais = new Dictionary&lt;long, int&gt;() { {materialId, quantidadeMaterial}};
        var dto = _fixture.Build&lt;ObraDto&gt;()
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .Without(x =&gt; x.Funcionarios)
            .With(x =&gt; x.Materiais, materiais)
            .Create();
        var orcamento = _fixture.Build&lt;Orcamento&gt;()
            .With(x =&gt; x.Id, orcamentoId)
            .Create();
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Returns(orcamento);
        _materialServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId)))
            .Throws(new NaoEncontradoException(&quot;Material n&#227;o encontrado&quot;));
        
        var resultado = () =&gt; _service.Adicionar(dto);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
    }

    [Fact]
    public void Editar_ComDadosValidos_DeveRealizarOperacao()
    {
        var obraId = 1;
        var obraDto = _fixture.Build&lt;ObraDto&gt;()
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .Without(x =&gt; x.OrcamentoId)
            .Without(x =&gt; x.PrazoConclusao)
            .Create();
        var obra = _fixture.Create&lt;Obra&gt;();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));
       
        _service.Editar(obraId, obraDto);
        
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _repositoryMock.Verify(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)), Times.Once);
    }
    
    [Fact]
    public void Editar_ComDadosValidosEOrcamento_DeveRealizarOperacao()
    {
        var obraId = 1;
        var orcamentoId = 1;
        var obraDto = _fixture.Build&lt;ObraDto&gt;()
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .Without(x =&gt; x.PrazoConclusao)
            .Create();
        var obra = _fixture.Create&lt;Obra&gt;();
        var orcamento = _fixture.Create&lt;Orcamento&gt;();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Returns(orcamento);
        
        _service.Editar(obraId, obraDto);
        
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _repositoryMock.Verify(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)), Times.Once);
        _orcamentoServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId)), Times.Once);
    }
    
    [Fact]
    public void Editar_ComDadosInvalidos_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        var obraDto = _fixture.Build&lt;ObraDto&gt;()
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .Create();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Throws(new NaoEncontradoException(&quot;Obra n&#227;o encontrada&quot;));
        
        var resultado = () =&gt; _service.Editar(obraId, obraDto);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
    }
    
    [Fact]
    public void Editar_ComDadosInvalidosEOrcamentoInexistente_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        var orcamentoId = 1;
        var obraDto = _fixture.Build&lt;ObraDto&gt;()
            .Without(x =&gt; x.Funcionarios)
            .Without(x =&gt; x.Materiais)
            .With(x =&gt; x.OrcamentoId, orcamentoId)
            .Without(x =&gt; x.PrazoConclusao)
            .Create();
        var obra = _fixture.Create&lt;Obra&gt;();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));
        _orcamentoServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == orcamentoId))).Throws(new NaoEncontradoException(&quot;Orcamento n&#227;o encontrado&quot;));
        
        var resultado = () =&gt;_service.Editar(obraId, obraDto);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
    }
    
    [Fact]
    public void Excluir_ComDadosValidos_DeveRealizarOperacao()
    {
        var obraId = 1;
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Excluir(It.Is&lt;Obra&gt;(x =&gt; x == obra)));

        var resultado = () =&gt; _service.Excluir(obraId);

        resultado.Should().NotThrow&lt;NaoEncontradoException&gt;();
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _repositoryMock.Verify(x =&gt; x.Excluir(It.Is&lt;Obra&gt;(x =&gt; x == obra)), Times.Once);
    }
    
    [Fact]
    public void Excluir_ComDadosInvalidos_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)))
            .Returns((Obra)null);

        var resultado = () =&gt; _service.Excluir(obraId);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
    }

    [Fact]
    public void GerenciarMaterial_ComDadosValidosAlocandoMaterial_DeveRealizarOperacao()
    {
        var obraId = 1;
        var materialId = 1;
        var quantidade = 1;
        var dto = _fixture.Build&lt;EntradaSaidaMaterialDto&gt;()
            .With(x =&gt; x.Operacao, EntradaSaidaEnum.Entrada)
            .With(x =&gt; x.Quantidade, quantidade)
            .Create();
        var material = _fixture.Create&lt;Material&gt;();
        material.MovimentarEstoque(EntradaSaidaEnum.Entrada, quantidade);
        _materialServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId))).Returns(material);
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));
        
        _service.GerenciarMaterial(dto, obraId, materialId);

        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _materialServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId)), Times.Once);
        _repositoryMock.Verify(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)), Times.Once);
    }
    
    [Fact]
    public void GerenciarMaterial_ComDadosValidosDesalocando_DeveRealizarOperacao()
    {
        var obraId = 1;
        var materialId = 1;
        var quantidade = 1;
        var dto = _fixture.Build&lt;EntradaSaidaMaterialDto&gt;()
            .With(x =&gt; x.Operacao, EntradaSaidaEnum.Saida)
            .With(x =&gt; x.Quantidade, quantidade)
            .Create();
        var material = _fixture.Create&lt;Material&gt;();
        material.MovimentarEstoque(EntradaSaidaEnum.Entrada, quantidade);
        _materialServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId))).Returns(material);
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        obra.AlocarMaterial(material, quantidade);
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));
        
        _service.GerenciarMaterial(dto, obraId, materialId);

        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _materialServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId)), Times.Once);
        _repositoryMock.Verify(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)), Times.Once);
    }
    
    [Fact]
    public void GerenciarMaterial_ComDadosInvalidos_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        var materialId = 1;
        var quantidade = 1;
        var dto = _fixture.Build&lt;EntradaSaidaMaterialDto&gt;()
            .With(x =&gt; x.Operacao, EntradaSaidaEnum.Saida)
            .Without(x =&gt; x.Quantidade)
            .Create();
        var material = _fixture.Create&lt;Material&gt;();
        material.MovimentarEstoque(EntradaSaidaEnum.Entrada, quantidade);
        _materialServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId))).Returns(material);
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        obra.AlocarMaterial(material, quantidade);
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));

        var resultado = () =&gt; _service.GerenciarMaterial(dto, obraId, materialId);

        resultado.Should().Throw&lt;OperacaoInvalidaException&gt;();
    }
    
    [Fact]
    public void GerenciarMaterial_ComDadosInvalidosEMaterialInexistente_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        var materialId = 1;
        var quantidade = 1;
        var dto = _fixture.Build&lt;EntradaSaidaMaterialDto&gt;()
            .With(x =&gt; x.Operacao, EntradaSaidaEnum.Saida)
            .With(x =&gt; x.Quantidade, quantidade)
            .Create();
        _materialServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == materialId))).Throws(new NaoEncontradoException(&quot;Material n&#227;o encontrado&quot;));
        var obra = _fixture.Build&lt;Obra&gt;()
            .Create();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _repositoryMock.Setup(x =&gt; x.Editar(It.Is&lt;Obra&gt;(x =&gt; x == obra)));

        var resultado = () =&gt; _service.GerenciarMaterial(dto, obraId, materialId);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
    }
    
    [Fact]
    public void AlocarFuncionario_ComDadosValidos_DeveRealizarOperacao()
    {
        var obraId = 1;
        var funcionarioId = 1;
        var obra = _fixture.Build&lt;Obra&gt;().Create();
        var funcionario = _fixture.Build&lt;Funcionario&gt;().Create();
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _funcionarioServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId))).Returns(funcionario);

        var resultado = () =&gt; _service.AlocarFuncionario(obraId, funcionarioId);

        resultado.Should().NotThrow&lt;NaoEncontradoException&gt;();
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _funcionarioServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId)), Times.Once);
    }
    
    [Fact]
    public void AlocarFuncionario_ComDadosInvalidosEFuncionarioInexistente_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        var funcionarioId = 1;
        _funcionarioServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId))).Throws(new NaoEncontradoException(&quot;Funcionario n&#227;o encontrado&quot;));

        var resultado = () =&gt; _service.AlocarFuncionario(obraId, funcionarioId);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
        _funcionarioServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId)), Times.Once);
    }
    
    [Fact]
    public void DesalocarFuncionario_ComDadosValidos_DeveRealizarOperacao()
    {
        var obraId = 1;
        var funcionarioId = 1;
        var funcionario = _fixture.Build&lt;Funcionario&gt;().Create();
        var obra = _fixture.Build&lt;Obra&gt;().Create();
        obra.AlocarFuncionario(funcionario);
        _repositoryMock.Setup(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId))).Returns(obra);
        _funcionarioServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId))).Returns(funcionario);

        var resultado = () =&gt; _service.DesalocarFuncionario(obraId, funcionarioId);

        resultado.Should().NotThrow&lt;NaoEncontradoException&gt;();
        _repositoryMock.Verify(x =&gt; x.BuscarPorId(It.Is&lt;long&gt;(x =&gt; x == obraId)), Times.Once);
        _funcionarioServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId)), Times.Once);
    }
    
    [Fact]
    public void DesalocarFuncionario_ComDadosInvalidosEFuncionarioInexistente_NaoDeveRealizarOperacao()
    {
        var obraId = 1;
        var funcionarioId = 1;
        _funcionarioServiceMock.Setup(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId))).Throws(new NaoEncontradoException(&quot;Funcion&#225;rio n&#227;o encontrado&quot;));

        var resultado = () =&gt; _service.DesalocarFuncionario(obraId, funcionarioId);

        resultado.Should().Throw&lt;NaoEncontradoException&gt;();
        _funcionarioServiceMock.Verify(x =&gt; x.BuscarEntidadePorId(It.Is&lt;long&gt;(x =&gt; x == funcionarioId)), Times.Once);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[22,5,22,55,1],[29,5,29,30,1],[30,5,30,6,1],[31,9,31,55,1],[32,9,32,43,1],[33,9,33,67,1],[34,9,34,61,1],[35,9,35,63,1],[36,9,36,68,1],[37,9,37,206,1],[38,5,38,6,1],[42,5,42,6,1],[43,9,43,58,1],[44,9,44,65,1],[45,9,45,68,1],[46,9,49,35,1],[51,9,51,48,1],[53,9,53,50,1],[54,9,54,53,1],[55,9,55,66,1],[56,9,56,95,1],[57,5,57,6,1],[61,5,61,6,1],[62,9,62,24,1],[63,9,64,23,1],[65,9,66,28,1],[68,9,68,62,1],[70,9,70,40,1],[71,9,71,45,1],[72,9,72,49,1],[73,9,73,95,1],[74,5,74,6,1],[78,5,78,6,1],[79,9,79,24,1],[80,9,81,34,1],[83,9,83,31,1],[83,31,83,67,1],[83,67,83,68,1],[85,9,85,60,1],[86,9,86,95,1],[87,5,87,6,1],[91,5,91,6,1],[92,9,92,24,1],[93,9,94,23,1],[95,9,95,50,1],[96,9,97,28,1],[98,9,99,31,1],[101,9,101,54,1],[103,9,103,40,1],[104,9,104,48,1],[105,9,105,52,1],[106,9,106,95,1],[107,9,107,100,1],[108,5,108,6,1],[112,5,112,6,1],[113,9,113,24,1],[114,9,115,34,1],[117,9,117,31,1],[117,31,117,59,1],[117,59,117,60,1],[119,9,119,60,1],[120,9,120,95,1],[121,5,121,6,1],[125,5,125,6,1],[126,9,126,29,1],[127,9,131,23,1],[132,9,134,23,1],[135,9,135,120,1],[137,9,137,31,1],[137,31,137,54,1],[137,54,137,55,1],[139,9,139,62,1],[140,9,140,80,1],[141,5,141,6,1],[145,5,145,6,1],[146,9,146,29,1],[147,9,152,23,1],[153,9,155,23,1],[156,9,156,120,1],[158,9,158,31,1],[158,31,158,54,1],[158,54,158,55,1],[160,9,160,59,1],[161,5,161,6,1],[165,5,165,6,1],[166,9,166,29,1],[167,9,171,23,1],[172,9,172,126,1],[174,9,174,31,1],[174,31,174,54,1],[174,54,174,55,1],[176,9,176,59,1],[177,5,177,6,1],[181,5,181,6,1],[182,9,182,29,1],[183,9,183,51,1],[184,9,188,23,1],[189,9,191,23,1],[192,9,192,120,1],[194,9,194,31,1],[194,31,194,54,1],[194,54,194,55,1],[196,9,196,62,1],[197,5,197,6,1],[201,5,201,6,1],[202,9,202,29,1],[203,9,203,28,1],[204,9,204,36,1],[205,9,205,89,1],[206,9,210,23,1],[211,9,213,23,1],[214,9,214,120,1],[215,9,216,76,1],[218,9,218,31,1],[218,31,218,54,1],[218,54,218,55,1],[220,9,220,60,1],[221,5,221,6,1],[225,5,225,6,1],[226,9,226,24,1],[227,9,232,23,1],[233,9,233,44,1],[234,9,235,28,1],[236,9,236,75,1],[238,9,238,42,1],[240,9,240,95,1],[241,9,241,88,1],[242,5,242,6,1],[246,5,246,6,1],[247,9,247,24,1],[248,9,248,29,1],[249,9,254,23,1],[255,9,255,44,1],[256,9,256,54,1],[257,9,258,28,1],[259,9,259,75,1],[260,9,260,120,1],[262,9,262,42,1],[264,9,264,95,1],[265,9,265,88,1],[266,9,266,114,1],[267,5,267,6,1],[271,5,271,6,1],[272,9,272,24,1],[273,9,276,23,1],[277,9,278,72,1],[280,9,280,31,1],[280,31,280,63,1],[280,63,280,64,1],[282,9,282,60,1],[283,5,283,6,1],[287,5,287,6,1],[288,9,288,24,1],[289,9,289,29,1],[290,9,295,23,1],[296,9,296,44,1],[297,9,298,28,1],[299,9,299,75,1],[300,9,300,164,1],[302,9,302,30,1],[302,30,302,62,1],[302,62,302,63,1],[304,9,304,60,1],[305,5,305,6,1],[309,5,309,6,1],[310,9,310,24,1],[311,9,312,23,1],[313,9,313,96,1],[314,9,314,76,1],[316,9,316,31,1],[316,31,316,55,1],[316,55,316,56,1],[318,9,318,63,1],[319,9,319,95,1],[320,9,320,89,1],[321,5,321,6,1],[325,5,325,6,1],[326,9,326,24,1],[327,9,328,34,1],[330,9,330,31,1],[330,31,330,55,1],[330,55,330,56,1],[332,9,332,60,1],[333,9,333,95,1],[334,5,334,6,1],[338,5,338,6,1],[339,9,339,24,1],[340,9,340,28,1],[341,9,341,28,1],[342,9,345,23,1],[346,9,346,52,1],[347,9,347,74,1],[348,9,348,117,1],[349,9,350,23,1],[351,9,351,96,1],[352,9,352,75,1],[354,9,354,61,1],[356,9,356,95,1],[357,9,357,112,1],[358,9,358,88,1],[359,5,359,6,1],[363,5,363,6,1],[364,9,364,24,1],[365,9,365,28,1],[366,9,366,28,1],[367,9,370,23,1],[371,9,371,52,1],[372,9,372,74,1],[373,9,373,117,1],[374,9,375,23,1],[376,9,376,51,1],[377,9,377,96,1],[378,9,378,75,1],[380,9,380,61,1],[382,9,382,95,1],[383,9,383,112,1],[384,9,384,88,1],[385,5,385,6,1],[389,5,389,6,1],[390,9,390,24,1],[391,9,391,28,1],[392,9,392,28,1],[393,9,396,23,1],[397,9,397,52,1],[398,9,398,74,1],[399,9,399,117,1],[400,9,401,23,1],[402,9,402,51,1],[403,9,403,96,1],[404,9,404,75,1],[406,9,406,31,1],[406,31,406,82,1],[406,82,406,83,1],[408,9,408,63,1],[409,5,409,6,1],[413,5,413,6,1],[414,9,414,24,1],[415,9,415,28,1],[416,9,416,28,1],[417,9,420,23,1],[421,9,421,161,1],[422,9,423,23,1],[424,9,424,96,1],[425,9,425,75,1],[427,9,427,31,1],[427,31,427,82,1],[427,82,427,83,1],[429,9,429,60,1],[430,5,430,6,1],[434,5,434,6,1],[435,9,435,24,1],[436,9,436,31,1],[437,9,437,52,1],[438,9,438,66,1],[439,9,439,96,1],[440,9,440,126,1],[442,9,442,31,1],[442,31,442,80,1],[442,80,442,81,1],[444,9,444,63,1],[445,9,445,95,1],[446,9,446,118,1],[447,5,447,6,1],[451,5,451,6,1],[452,9,452,24,1],[453,9,453,31,1],[454,9,454,170,1],[456,9,456,31,1],[456,31,456,80,1],[456,80,456,81,1],[458,9,458,60,1],[459,9,459,118,1],[460,5,460,6,1],[464,5,464,6,1],[465,9,465,24,1],[466,9,466,31,1],[467,9,467,66,1],[468,9,468,52,1],[469,9,469,45,1],[470,9,470,96,1],[471,9,471,126,1],[473,9,473,31,1],[473,31,473,83,1],[473,83,473,84,1],[475,9,475,63,1],[476,9,476,95,1],[477,9,477,118,1],[478,5,478,6,1],[482,5,482,6,1],[483,9,483,24,1],[484,9,484,31,1],[485,9,485,170,1],[487,9,487,31,1],[487,31,487,83,1],[487,83,487,84,1],[489,9,489,60,1],[490,9,490,118,1],[491,5,491,6,1]]);
    </script>
  </body>
</html>